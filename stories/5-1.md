# Story 5.1: Central API Server

**Epic:** 5 - Central Management Platform
**Status:** ‚ùå TODO

## Description
Build a centralized REST API server on EC2 that aggregates data from all Pi gateways, provides unified device management, handles image storage, and supports the web dashboard. Built with Django or FastAPI for scalability.

## Goals
- Unified API for all sites and devices
- Aggregate data from multiple Pi gateways
- Centralized image storage (S3 or local)
- User authentication and authorization
- Site/device management endpoints
- Real-time event streaming (WebSocket)
- API documentation (OpenAPI/Swagger)

## Key Components
- FastAPI or Django REST Framework
- PostgreSQL database for metadata
- S3 for image storage (encrypted)
- Redis for caching and pub/sub
- WebSocket server for real-time updates
- JWT authentication
- OpenAPI documentation

## Key Endpoints
- POST /api/sites - Create site
- GET /api/sites/{id}/devices - List devices
- GET /api/events - Query events
- POST /api/images/upload - Receive from Pi
- WS /api/stream - Real-time events
- GET /api/devices/{id}/status - Device status
- POST /api/camera/control - Remote camera control

## Acceptance Criteria
- [ ] RESTful API with CRUD for sites/devices
- [ ] Handles 100+ requests/second
- [ ] WebSocket streaming for real-time updates
- [ ] JWT authentication working
- [ ] S3 integration for encrypted image storage
- [ ] PostgreSQL for metadata (sites, devices, events)
- [ ] Redis caching reduces DB load
- [ ] OpenAPI docs available at /docs
- [ ] API versioning (v1, v2)
- [ ] Rate limiting per user/API key

## Dependencies
- Story 1.5 (EC2 infrastructure)
- Story 4.3 (Pi store-forward)
- Story 6.2 (Encryption)
- FastAPI/Django, PostgreSQL, Redis, S3
