# Story 6.3: Dynamic Key Management

**Epic:** 6 - Security & Production Readiness
**Status:** ❌ HIGH PRIORITY

## Description
Build a secure key management system using a Go HTTP server on Pi gateways that distributes police public keys to ESP32 devices, handles key rotation, caching, and provides audit trails. Enables centralized key management across all sites.

## Goals
- Centralized key distribution from EC2 to Pi to ESP32
- Daily automatic key refresh
- Key caching on ESP32 (24-hour TTL)
- Audit trail for all key operations
- Support multiple jurisdictions/keys
- Zero-downtime key rotation
- Backup key server for redundancy

## Architecture
```
EC2 (Master Key Server)
  ↓ HTTPS (daily sync)
Pi Gateway (Go Key Server)
  ↓ HTTP (on demand + daily refresh)
ESP32-CAM (Key Cache)
```

## Key Server (Go)
- HTTP server on Pi (port 8080)
- Endpoints: GET /keys/{jurisdiction}, GET /keys/latest
- SQLite database for key storage
- TLS for ESP32 connections (optional)
- Rate limiting per device
- Audit logging

## Key Rotation Process
1. Police upload new public key to EC2
2. EC2 pushes to all Pi gateways (via SSH tunnel)
3. Pi notifies ESP32 devices (via push or poll)
4. ESP32 fetches new key
5. Old key remains valid for grace period (24 hours)

## Acceptance Criteria
- [ ] Go HTTP server running on Pi gateway
- [ ] ESP32 fetches keys via HTTP GET
- [ ] Keys cached on ESP32 for 24 hours
- [ ] Daily automatic key refresh
- [ ] Supports multiple jurisdiction keys
- [ ] Key rotation with zero downtime
- [ ] Audit log of all key access
- [ ] EC2 master key server implemented
- [ ] Push notifications for emergency key updates
- [ ] Key validation (signature verification)

## Dependencies
- Story 1.5 (Pi infrastructure)
- Story 6.2 (Public key encryption)
- Story 6.4 (Emergency revocation)
- Go 1.21+, SQLite
