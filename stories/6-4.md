# Story 6.4: Emergency Key Revocation System

**Epic:** 6 - Security & Production Readiness
**Status:** ‚ùå HIGH PRIORITY

## Description
Implement an emergency key revocation mechanism that can instantly invalidate compromised encryption keys across all devices in <60 seconds. Uses push notifications via WebSocket or MQTT to force immediate key refresh.

## Goals
- Revoke compromised keys in <60 seconds
- Push notification to all devices (not just polling)
- Force immediate key refresh on all ESP32s
- Prevent new images encrypted with revoked key
- Audit trail for all revocations
- Rollback capability if revocation in error

## Key Components
- WebSocket/MQTT server for push notifications
- Revocation command API endpoint
- ESP32 WebSocket client (always connected)
- Certificate revocation list (CRL)
- Emergency revocation dashboard
- Incident response runbook

## Revocation Flow
1. Admin triggers revocation on EC2 dashboard
2. EC2 broadcasts WebSocket message to all Pis
3. Pi forwards to all connected ESP32s
4. ESP32 marks key as revoked immediately
5. ESP32 fetches new key within 60 seconds
6. All subsequent images use new key

## Acceptance Criteria
- [ ] WebSocket server on EC2 and Pi
- [ ] ESP32 maintains persistent WebSocket connection
- [ ] Revocation command reaches devices <60 seconds
- [ ] ESP32 refuses to encrypt with revoked key
- [ ] Automatic failover to new key
- [ ] Revocation logged and auditable
- [ ] Dashboard for emergency revocation
- [ ] Rollback capability
- [ ] Alert operators of revocation events
- [ ] Test procedure for revocation drills

## Dependencies
- Story 6.2 (Public key encryption)
- Story 6.3 (Key management)
- Story 5.1 (Central API)
- WebSocket or MQTT libraries
