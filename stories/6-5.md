# Story 6.5: ESP32 ↔ Pi Authentication

**Epic:** 6 - Security & Production Readiness
**Status:** ❌ TODO

## Description
Implement mutual authentication between ESP32 devices and Raspberry Pi gateways using pre-shared keys or JWT tokens to prevent unauthorized devices from joining the network and ensure only legitimate Pis can control cameras.

## Goals
- Mutual authentication (ESP32 ↔ Pi)
- Prevent rogue devices from joining network
- Prevent unauthorized camera control
- Token-based or PSK authentication
- Token refresh and expiration
- Audit trail of authentication events

## Key Components
- JWT token generation on Pi
- Token validation on ESP32 API endpoints
- Pre-shared key provisioning during device setup
- Token refresh mechanism
- Authentication failure logging
- Device whitelisting

## Authentication Flow
1. ESP32 boots, attempts registration with Pi
2. Pi validates device MAC address against whitelist
3. Pi generates JWT token (24-hour expiry)
4. ESP32 stores token, uses in all API requests
5. Pi validates token on every request
6. Token auto-refreshes before expiry

## Acceptance Criteria
- [ ] JWT token generation on Pi
- [ ] ESP32 includes token in all API requests
- [ ] Pi validates tokens (signature + expiry)
- [ ] Token refresh before 24-hour expiry
- [ ] Unauthorized requests return 401
- [ ] Device whitelist enforcement
- [ ] Failed auth attempts logged
- [ ] Manual device approval workflow
- [ ] Token revocation capability
- [ ] PSK fallback for initial setup

## Dependencies
- Story 3.1 (ESP32 API)
- Story 3.2 (ESP32 ↔ Pi Communication)
- JWT library (ESP32 + Python)
